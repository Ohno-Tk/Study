# 資格勉強_AWS Certified Cloud Practitioner

## 目次
* [視聴したコンテンツ](#contentsWatch)
* [AWSとは？](#contents1)
* [クラウドとAWSの概要](#contents2)
* [クラウドの基礎](#contents3)
* [AWSサービスの概要](#contents4)
* [AWSのグローバルインフラ構成](#contents5)
* [オンプレミスとAWSクラウドの良し悪し](#contents6)
* [AWSの操作](#contents7)
* [EC2](#contents8)
* [EBS](#contents9)
* [サブネットとサブネットマスク](#contents10)
* [VPC](#contents11)
* [通信プロトコルとOSIモデル](#contents12)
* [ネットワークACLとセキュリティグループ](#contents13)
* [Route53](#contents14)
  * [DNSの名前解決](#contents15)
* [AWSアーキテクチャの設計原則](#contents16)
* [ELB](#contents17)
* [Auto-Scaling](#contents18)
* [S3](#contents19)
* [データベースの基礎](#contents20)
* [RDB](#contents21)
* [AWSの責任共有モデル](#contents22)
* [IAMの概要](#contents23)
* [CloudTrailの概要](#contents24)
* [CloudWatchの概要](#contents25)
* [AWSコスト管理](#contents26)


<a id="contentsWatch"></a>

## 視聴したコンテンツ
* [【CLF-C02版】これだけでOK! AWS認定クラウドプラクティショナー試験突破講座（豊富な試験問題300問付き）](https://persolpt-eng.udemy.com/course/ok-aws-e/)

## AWSとは？
<a id="contents1"></a>

インフラやアプリ開発に必要な機能がいつでも、どこでも即時に利用できるクラウドサービスのこと。

オンプレサーバとの違い
* 数分で立ち上がる  
オンプレは時間がかかる

* 無料で利用可能  
オンプレはコストがかかる

**物理的な危機をネットサービスへ**  
システム運用に必要な物理機器をインターネット経由で借りてくることで、  
効率的なシステム管理が可能になる。

**サービスが豊富**  
システム構築・運用に必要なサービスが一通りそろっており、  
200以上のサービスから容易に組み合わせて利用できる。

**最先端の技術**  
AI・ブロックチェーン・量子コンピュータ・AR・VRなどの最先端技術がクラウドで提供され、すぐに利用できる。

**グローバルに展開**  
グローバルなインフラ(物理的なIT機器)を有しており、日本にいながら世界中にITインフラを構築できる。

## クラウドとAWSの概要
<a id="contents2"></a>

### 仮想化を理解する
クラウドは仮想化技術によって成り立っている。  

仮想化とは、物理的なインフラ構成を隠して、「1つのインフラ機器を複数」または「複数のインフラ機器」を1つに見せかける(仮想)する技術のこと

**仮想化の仕組み**  
物理的なインフラに仮想化ソフトウェアを設定して、仮想化範囲を複数のユーザに切り分けて提供することができる。つまり、1つの物理機器をみんなでシェアできる。  

仮想化ソフトウェアの例
* ホスト側(VMWARE)
* ハイパーバイザ型

**仮想化の対象**
* サーバの仮想化
  * 1代の物理サーバ上に複数のOSを動作させる技
  * ハイパーバイザ型/ホスト型/コンテナ方式
* ストレージの仮想化
  * 複数のストレージを仮想的に統合して1つの大きなストレージプールを構成する技術
  * ブロックレベル仮想化/ファイルレベル仮想化
* ネットワークの仮想化
  * 新たな仮想ネットワークの構築や制御を、ソフトウェアにより動的に実施する技術
  * SDN/VLAN
* デスクトップの仮想化
  * サーバ上においたPC環境のデスクトップ画面を遠隔地にある接続端末に転送する技術
  * 仮想PC方式/ブレードPC方式

**仮想化のメリット**  
仮想化を利用する事でインフラ利用の効率性や柔軟性が圧倒的に向上する

* 仮想化の主なメリット
  * サーバスペースの削減
  * データセンター費用の削減
  * 効率的なサーバ利用によるコスト削減
  * 物理的な機器を調達するのではなく、仮想化によりサーバ領域を分割提供することによる調達の迅速化
  * 構成変更やメンテナンス対応の柔軟性
  * セキュリティの向上

**コンテナ**  
コンテナは、ホストマシン(仮想化のホストとなる物理機器)のカーネルを利用し、プロセスなどを隔離する仮想化方式

**SDI**  
SDI(Software-Defined Infrastructure)はソフトウェアによってコードによりインフラ構成を実現する機能  
JSON/YAMLなどのコードでインフラ構築方式がポリシーとして定義されており、それに基づいて仮想化インフラが構築可能

<a id="contents3"></a>

### クラウドの基礎
**クラウドとは**  
必要に応じて他社所有のハードウェア・ソフトウェア等をネットワークを介して利用するシステム利用形態  

こんな時はクラウドに...  
* 短期的なキャンペーン用に一時的にサーバが欲しい。
* 需要増に応じサーバを増強し、需要減には削減したい。
* 今すぐデータベースが必要だけど調達している時間がない。

**クラウドの構成要素**  
クラウドで提供されるシステム構成要素はインフラ、ミドルウェア、アプリケーションの3層
* インフラ
  * 物理的な機器(ハードウェア)
  * ネットワーク回線
* ミドルウェア
  * ミドルウェアとは共通利用される機能をまとめたソフトウェア
  * Windowsなどの基本ソフト(OS：オペレーティングシステム)
* アプリケーション
  * プログラミング開発したアプリケーション
  * 業務機能が実装されたパッケージングソフトウェア

**クラウドの5つの基本特性**  
クラウドの特徴として「5つの基本特性」「3つのサービス「3つの提供形態」がある。

* 5つの基本特性
  * オンデマンド・セルフサービス  
  利用者は人を介さず、必要に応じてサーバ・ネットワーク・ストレージを設置・拡張・設定が可能
  * 幅広いネットワークアクセス  
  ネットワークを通してPC、スマホ、タブレットなど各種デバイスから利用可能
  * リソースの共有  
  ハードウェアの使用容量などのリソースは複数利用者により共有し、利用者の需要に応じて動的に割り当てる。物理的配置は考慮不要
  * 迅速な拡張性  
  ハードウェア等の資源は必要に応じて自動または主導で増やしたり、減らしたりできる。
  * サービスは計測可能  
  稼働状況が常に計測されており、利用状況をコントロール・最適化できる。  
  計測結果に応じて従量課金が必要。

* 3つのサービス形態
  * SaaS  
  クラウド事業者がアプリケーションまで提供  
  自社はすぐにアプリケーションを利用可能
  * PaaS  
  クラウド事業者がミドルウェアまで提供  
  自社はアプリケーション開発に専念
  * IaaS  
  クラウド事業者が、ハードウェア提供  
  自社でミドルウェア・OSを購入し、アプリケーション開発

* 3つの提供形態  
クラウド提供形態はプライベート型とパブリック型が主流。  
加えて両方を併用するハイブリット型の提供形態がある。

  * オンプレミス(自社所有)
    * 所有形態：自社所有
    * 特徴：ハードウェア/ソフトウェアを購入し、自社にシステムを構築
    * メリット：自社でハードウェアを自由にコントロール可能
    * デメリット：調達・構築に時間を要す。  
    運用管理に人材・コストを要す。

  * プライベートクラウド
    * 所有形態：自社所有
    * 特徴：自社内にクラウド基盤を構築し、ハードウェア・ソフトウェアを事業部や子会社間で共同利用
    * メリット：自社資産の効率化。パブリックと比較しコントロールが自由
    * デメリット：クラウド運用管理が難しく、クラウドのメリットが低下

  * パブリッククラウド
    * 所有形態：他社所有
    * 特徴：ハードウェア/ソフトウェアを他社と共同利用し、柔軟に構築。解除が可能
    * メリット：運用管理を他社に委任可能。  
    システム調達・構築の自由度が高い。
    * デメリット：自社コントロールの範囲が制限

<a id="contents4"></a>

### AWSサービスの概要
**AWSの仕組み**  
インフラ/システム機能をブロックパーツの様にオンライン上に組み合わせて自分の好きな構成を実現する仕組み

<a id="contents5"></a>

### AWSのグローバルインフラ構成
リージョンとアベイラビリティゾーン(AZ)とエッジロケーションを中心に世界中にDCを展開している。

**リージョン**
リージョンはデータセンターが集積された地理的なロケーションの事  
日本には東京と大阪の2つのリージョンが存在している。

* データセンターが集積されている世界中の物理的ロケーションの事。
* AWSでは、北米、南米、欧州、中国、アジアパシフィック、南アフリカ、中東などのリージョンを含む、複数の地理的なリージョンを整備している。
* リージョンに応じて価格と利用可能なサービスが少し異なる。
* 各AWSリージョンは、1つの地理的エリアにある、隔離され物理的にも分離された複数のAZによって構成される。
* 1つのリージョンにはユーザが利用可能なAZが2つ以上構成されている。

**アベイラビリティゾーン**  
アベイラビリティゾーンは1つ以上のデータセンターで構成された論理的なデータセンターのグループ

* 1つのAWSリージョン内でそれぞれ切り離され、冗長的な電力源、ネットワーク、そして接続機能を備えている1つ以上のデータセンターであり、論理的データセンターのグループ
* AZは1つ以上のデータセンターで構成されており、AWSリソースを提供するサーバが設置されている。
* AZによって、単一のデータセンターでは実現できない高い可用性、耐障害性、および拡張性を備えた本番用システムの運用が可能になる。
* 各AZには個別の電力源、冷却システム、物理的セキュリティが備わっており、AZ間は冗長で低レイテンシーなネットワークを介し接続されている。
* アプリケーションからAZ間で分割されている場合は停電、落雷、竜巻、地震などの問題からより安全に隔離され保護される。
* 同じリージョンにある各AZハソレゾレホカノAZから物理的に意味のある距離(数キロメートル)があるものの、お互いは100km(60マイル)以内に配置されている。

**エッジロケーション**  
グローバルなコンテンツ配信に利用されるロケーションのこと

* AWSのAZを構成するデータセンターとは別にコンテンツ配信を実行する高速・広帯域なネットワークロケーションの事。
* 600以上のPOP(Point Of Persence)とリージョナルエッジキャッシュで構成されており、全世界にエッジロケーション設備が展開されている。
* ユーザに近いロケーションにキャッシュサーバを設置して、キャッシュ(一時保存用データ)を保存することで、頻繁にアクセスされやすいデータへの配信を高速化することが出来る。

**AWSローカルゾーン**  
レイテンシーの影響を受けやすいapplicationを炎でユーザにより近い場所で実行するためのロケーション

* 1桁ミリ秒単位のレイテンシー(ユーザのアクションとその後の応答の間に経過する時間)を要求する革新的なアプリケーションに対して、ユーザからの引きレイテンシーアクセスを実現するための特別なロケーションの事。
* リージョンから距離がある大都市(人口の多い場所や産業の中心地)の近くに配置されており、高速アプリケーションを展開することが出来る。
* コンピューティング、ストレージ、データベース、およびその他の選択されたAWSのサービスをエンドユーザに近い場所に配置できる。
* ローカルとAWSリージョンでそれぞれ実行中のワークロード間で高速域幅かつ安全な接続が利用できる。

**Wavelength Zone**  
5Gネットワークを利用した高速アプリケーションを開発できるロケーションの事。

* 5Gネットワークのエッジにある通信proぱいだーのデータセンターに、AWSのコンピューティング及びストレージサービスを組み込んだAWSインフラストラクチャのデプロイ可能なロケーション
* モバイルデバイスおよびエンドユーザに対して10ミリ秒未満のレイテンシーを実現するアプリケーションを構築できる。
* ゲーム、ライブ動画ストリーミング、エッジでの機械学習推論、拡張現実やバーチャルリアリティ(AR/VR)など、10ミリ秒未満のレイテンシーが必要なアプリケーションを実現

<a id="contents6"></a>

### オンプレミスとAWSクラウドの良し悪し
**クラウドのメリット/デメリット**  
迅速に柔軟にリソースを活用できるクラウドの明っとに対して、ベンダーロックインという最大のデメリットがある。

* メリット
  * オンデマンドでリソースを柔軟に迅速に活用することができる。
  * オンプレミス環境とのハイブリッドやオンプレミス環境にAWSクラウドサービスを展開する事も可能
  * 下手に自社DC内でインフラを構成するよりも、AWSに依存した方がよっぽどセキュリティは高い
* デメリット
  * クラウド業者のサービスに依存してしまうベンダーロックイン
  * データ保存先や活用で社内での保管が義務付けられている等、クラウド環境が利用できない

**ベンダーロックインとは？**  
AWS独自のサーバレスの仕組みをアプリに組み込んで機能開発してしまうと、環境移行が困難になる。

<a id="contents7"></a>

## AWSの操作
AWSの操作は3つ
* AWSマネジメントコンソール  
WEB画面からAWSを設定できるGUIツール
* インスタンス操作(SSH等)  
設置したインスタンス(サーバ)の操作はWindowsサーバやLinuxサーバなどに準じたソフトウェアを利用
* AWS CLI操作  
コマンドラインから複数のAWSサービスを制御・管理することが可能

<a id="contents8"></a>

# AWSのコアサービス
## EC2
**EC2とは何か？**  
オンプレミス環境にあるサーバと同じ性能を盛ったサーバをインターネット上で瞬時に作成することが出来るサービス

**EC2の特徴**  
数分で利用可能となる従量課金(時間～秒単位)で利用可能な仮想サーバ
* 起動される仮想サーバの単位をインスタンスと呼ぶ
* 起動・ノード追加・削除・マシンスペック変更できる仮想サーバを提供する
* WindowsやLinuxなどのほとんどのOSをサポート
* OSまでは提供されているタイプを選択することで自動設定され、OSより上のレイヤーをユーザが自由に利用する
* インスタンスの設定データはイメージという形式でAmazon Machine Image(AMI)に保存される。  
AMIはインスタンスの設定を保存したり、起動したりできる。
* EC2内部の関連機能としてEBS・ELB・Auto Scalingが含まれている。  

EC2では様々なOSを選択したうえで、CPU、メモリ、ストレージなどの性能を選択して、仮想サーバを起動することが出来る。
* オペレーティングシステムとしてのイメージの選択
* インスタンスタイプの設定
  * CPUのクロック数とコア数
  * メモリ容量
* ストレージタイプと容量
  * ネットワークディスク(EBS)
  * 物理ディスク(インスタンスストア)
* セキュリティグループによりトラフィックを制御

**EC2の利用コスト**  
EC2はインスタンスタイプや購入方式に応じて価格が決定する。
* 購入方式  
購入形式に応じて様々な利用料金が設定されている
  * オンデマンド：通常価格
  * リザーブド/Saving Plan：予約と事前支払の割引を適用
  * スポットインスタンス：最大90%割引を適用
* インスタンスタイプに応じた料金設定
  * インスタンスタイプに応じて価格が決定される。  
  利用時間によって価格を決定する。
  * a1.mediumは0.0255USD/時間
* 時間課金の設定
  * 秒単位(最低60秒)で支払う
  * 1秒利用すると60秒分の課金が発生する
  * EBSも同様に秒単位で課金される。
* リージョン
  * リージョンごとにインスタンスの価格が異なる。
* データ転送
  * データ転送イン(外部からデータを受信する処理)：無料
  * インターネットへのデータ転送アウト(外部へとデータを送信する処理)(GBあたり)
  * S3からAWS内でのデータ転送アウト(GBあたり)
* ボリューム
  * アタッチされたEBSに保存されたデータ容量にも課金される。インスタンスを停止してもEBS分の課金が継続されるために注意が必要。
  * インスタンスストアには課金されない。
* Running/開始/再起動
  * 実行時間に応じて料金が発生する。
  * 利用中のEBSボリュームの料金が発生する。
* 停止/Stop
  * EC2の料金発生は停止する。
  * 利用中のEBSボリュームの料金が発生する。
* 終了/Terminate
  * EC2の料金発生は停止する。
  * デフォルト設定ではルートボリュームに設定されたEBSボリュームも削除され、料金発生は停止する。
  * ただし、EBSは削除されない設定もできる。その場合はEBSボリュームの料金が継続する。

**ユーザデータの利用**  
ユーザデータを利用してEC2インスタンス起動時に実行されるスクリプトを設定できる。
* ユーザデータ
  * ユーザデータにスクリプトを設定することで、EC2インスタンス起動時に詳細設定が自動化される。
  * Bashスクリプトなど利用して、インスタンス起動時の設定を記述することが出来る。
* ブートストラップ
  * インスタンスにユーザデータを渡すことで、起動時に実行される処理の事

**ストレージの選択(ルートボリューム)**  
EC2で直接利用するストレージはホストサーバと不可分で設定されるインスタンスストアとユーザが追加するEBSの2つのタイプがある

* インスタンスストア
  * ホストコンピュータに内蔵されたディスクでEC2と不可分のブロックレベルの物理ストレージ
  * EC2の一時的なデータが保持され、EC2の停止・終了と共にデータは消去される
  * 無料

* Elastic Block Store(EBS)
  * ネットワークで接続されたブロックレベルのストレージでEC2とは独立して管理される
  * EC2をTerminate(停止)してもEBSはデータを保持可能。  
  また、バックアップとしてSnapshotをS3に保存する。
  * 別途EBS料金が必要

**ストレージの選択(オプション)**  
オプションでファイルシステム(ファイル形式のストレージ)を構成する事もできる。

* Amazon EFS
  * NASに似たファイルストレージ
  * ファイルシステムとして利用し、複数のEC2インスタンスでの共有アクセスが可能

* Amazon FSx For Windows File Server
  * Windows File Serverと互換性のあるストレージ
  * Windows上に構築され、Windows AD、OSやソフトウェアとの連携が豊富に可能

**物理対応可能なインスタンス**  
物理サーバにインスタンスを起動して制御が可能なタイプのインスタンス

* Dedicated Instance(ハードウェア専有インスタンス)
  * 専用HWのVPCで実行されるEC2インスタンス
  * ホストHWのレベルで、他のAWSアカウントに属するインスタンスから物理に分離する
  * 同じAWSアカウント内の別ユーザのインスタンスとホストサーバを共有する可能性がある

* Dedicated Host
  * 仮想サーバ利用時のホストサーバを完全に特定のユーザ専用にして、他のユーザと共有しない。
  * 物理サーバに紐づけられたソフトウェアライセンスを利用することができる。

* Bare Metal
  * 基盤となるサーバのプロセッサとメモリに直接アクセス可能なインスタンス
  * AWSの各種サービスとの連携が可能でOSが直接下層のハードウェアにアクセスができる。

<a id="contents9"></a>

## EBS
**EBSとは何か？**  
EBSはEC2インスタンスと共に利用されるブロックストレージ。  
インスタンス上で実行されるワークロードのデータ処理に利用。

**EBSの選択**  
AWSは3つの形式のストレージサービスを提供。

* ブロックストレージ
  * EC2にアタッチして活用するディスクサービス
  * ブロック形式でデータを保存
  * 高速・広帯域幅
  * 例：EBS、インスタンスストア

* オブジェクトストレージ
  * 安価かつ高い耐久性をもつオンラインストレージ
  * オブジェクト形式でデータを保存
  * デフォルトで複数AZに冗長化されている。
  * 例：S3、Glacier

* ファイルストレージ
  * 複数のEC2インスタンスから同時にアタッチ可能な共有ストレージサービス
  * ファイル形式でデータを保存
  * 例：EFS

EC2が利用するのはインスタンスストアとEBSの2タイプのストレージ

* インスタンスストア
  * ホストコンピュータに内蔵されたディスクでEC2と不可分のブロックレベルの物理ストレージ
  * EC2の一時的なデータが保持され、EC2の停止・終了と共にデータがクリアされる
  * 無料

* Elastic Block Store(EBS)
  * EC2にはネットワーク接続されたブロックレベルのストレージ、EC2とは独立で管理される。
  * EC2を終了してもEBSデータは保持可能。
  * SnapshotをS3に保持可能。
  * 別途EBS料金が必要。

**スナップショットの管理**  
スナップショットの作成時にはストレージを静止することが推奨されているものの、いつでもバックアップを実行可能で、EBS操作に影響を与えない。DLMによりバックアップ取得期間を設定可能

* スナップショット作成時はデータ整合性を保つため静止することが推奨
  * ソフトウェアの機能を利用
  * ファイルシステムの機能を利用
  - バックアップソフトウェアの機能を利用
  - アプリケーションの停止
  - ファイルシステムのアンマウントなど

* 保存期間や世代数は無制限
* 世代管理が必要な場合はAWS CLIやAPIなどで自動化する
* Amazon DLMを利用してEBSボリュームのスナップショット取得をスケジューリングできる。

**EBSボリュームの削除**  
EC2インスタンスの削除と共にEBSは削除されるため、データを保持したい場合は設定変更が必要

* ルートボリュームのEBS
  * EBS^backed AMIインスタンスにはルートボリュームにEBSが利用されている。
  * デフォルト設定ではEC2インスタンスの削除と共にEBSボリュームも削除される。

* DeleteOnTermination属性
  * DeleteOnTermination属性を有効化しているとEC2インスタンスの削除に応じてEBSも削除される
  * 非有効化することで、EC2インスタンスを削除してもEBSボリュームのみ保持可能

**EBSの暗号化**  
EBSはKMSのCMKを利用して、ボリューム作成時とスナップショット作成時に暗号化を実施する。

* EBSの暗号化
  * EBSボリュームやスナップショット作成時、AWS KMSのカスタマーマスターキー(CMK)を使用して暗号化を実施
  * インスタンスとそれに接続されたEBSストレージ間のデータ転送と保存データの両方に対して暗号化を実施する。

* 暗号化対象
  * ボリューム内の保存データ
  * ボリュームとインスタンスの間の転送データ
  * ボリュームから作成された全てのスナップショット
  * それらのスナップショットから作成された全てのボリューム

**EBSとRAID構成**  
パフォーマンス向上と冗長化を高める目的で、EBSでは主にRAID0とRAID1の構成が実施される

* RAID0(ストライピング)
  * 目的：パフォーマンスを向上させる。
  * RAID0は、2つ以上のボリュームを1台のボリュームに合わせてパフォーマンスを向上させる。
  * 複数ボリュームを合わせたパフォーマンスになる。

* RAID1(ミラーリング)
  * 目的：ボリュームの冗長性を高める。
  * RAID1では複数のボリュームに同時にデータを書き込むため、片方が壊れても、片方にデータが残る。

<a id="contents10"></a>

## サブネットとサブネットマスク
**IPアドレスとサブネットマスク**  
IPアドレスは3桁(0~255)の数字を4つ組み合わせる。  
各桁が8つのバイナリ値の集合を表す。

【表記方法】10.0.0.255

サブネットマスクは、IPアドレス表記の後に/数値で付属している

【表記方法】10.0.0.255 **/24**

**CIDR(Classless Inter-Domain Routing)**  
サブネットマスクにより、2進数表記でサブネット内で利用できないIP範囲がロックされる。  
サブネットでは、それ以外がIPアドレスとして利用できる。

【表記方法】10.0.0.255 **/8**  
00001010⇒ロック

【表記方法】10.0.0.255 **/16**  
00001010⇒ロック  
00000000⇒ロック

/16ではロックされていない16桁分のビット数が有効なIPアドレスとして活用できる。

**ネットワーク部とホスト部**  
サブネットマスクによって固定される範囲をネットワーク部、利用可能な範囲をホスト部と呼ぶ

**サブネットによるグループ化**  
サブネットマスクによるグループ化されたアドレス範囲内をサブネットと呼ぶ

<a id="contents11"></a>

### VPC
**VPCとは何か？**  
VPCはAWSクラウドのネットワークからユーザ専用の領域を切り出す事が出来る仮想ネットワークのサービス

**Virtual Private Cloud**  
VPCはAWSクラウド内に論理的に分離されたセクションを作り、ユーザが定義した仮想ネットワークを構築するサービス

* リージョン内に5つまでVPCを設定可能(上限緩和申請可能)
* 任意のIPアドレス範囲(CIDR)を選択して仮想ネットワークを構築
  * 最小サイズは/28
  * 最大サイズは/16
* VPCはプライベートIPアドレスによってネットワークレンジを設定
* サブネットの作成、ルートテーブルやネットワークゲートウェイの設定などにより、仮想ネットワーキング環境を完全に制御できる。
* 必要に応じてクラウド内外のネットワーク同士を接続したり、外部のネットワークと接続することが可能

**デフォルトVPC**  
AWSアカウントを作成すると、自動的に各リージョンに1つずつデフォルトVPCとデフォルトサブネットが生成される。

* デフォルトでIPv4 CIDRブロック(172.31.0.0/16)のVPCを作成する。  
これは、最大65,536個のプライベートIPv4アドレスを提供する。
* 各アベイラビリティゾーンに、サイズ/20のデフォルトサブネットを作成する。  
この場合、サブネットあたり最大4,096個のアドレスが作成される。
* インターネットゲートウェイを作成して、デフォルトVPCに接続する。
* デフォルトのセキュリティグループを作成し、デフォルトVPCに関連づける。
* デフォルトVPCを備えたAWSアカウントにはデフォルトDHCPオプションセットを関連づける。
* パブリックとプライベートのDNSホスト名が付与される。

【用語解説】  
デフォルトDHCPオプションセット：VPC内に関連付けるDHCP関連の設定の事。VPC内で起動したインスタンスにこの設定が反映される。  
DHCP："Dynamic Host Configuration Protocol"の略称でTCP/IPネットワークのホストに設定情報を渡す。

**サブネット**  
サブネットはCIDRで分割したVPCのネットワークセグメント

**サブネットのレンジ**  
VPCとサブネットにはCIDR(IPアドレス範囲)が付与され、ネットワーク範囲が決まる。

**ゲートウェイの設定**  
VPCコンソールで作成・管理できるゲートウェイは以下の通り

* インターネットゲートウェイ
  * インターネットへの出入り口となるゲートウェイ
  * デフォルトゲートウェイとして利用されることが多い。
  * インターネットゲートウェイをVPCに1つ設置する。

* NATゲートウェイ
  * プライベートサブネットのリソースからインターネットへのトラフィックを可能にするためのゲートウェイ
  *プライベートアドレスをパブリックアドレスに変換して、インターネットゲートウェイに連携される。

* Egress-Only Internet GateWay
  * IPv6向けのインターネットゲートウェイ
  * IPv6経由でのVPCからインターネットへの送信を可能にし、インターネットからのインスタンスへの接続は防ぐ。

* カスタマーゲートウェイ
  * オンプレミス環境と接続する際に利用するゲートウェイ
  * カスタマーゲートウェイデバイスまたはソフトウェアアプリケーションに関する情報をAWSに提供する。

* 仮想プライベートゲートウェイ
  * 仮想プライベートゲートウェイは、VPNトンネルのAmazon側にあるルータ
  * VPN接続時に利用する。

**VPCにおけるDNSの使用**  
VPC内で起動したインスタンスがパブリックIPアドレスを利用するためにはDNSホスト名を取得する必要がある。

* enableDnsHostnames
  * パブリックIPアドレスを持つインスタンスが、対応するパブリックDNSホスト名を取得するかどうか示す。
  * この属性がtrueでenableDnsSupport属性もtrue場合、VPC内のインスタンスはDNSホスト名を取得する。

* enableDnsSupport
  * DNS名前解決がサポートされているかどうかを示す
  * この属性がfalseの場合、パブリックDNSホスト名をIPアドレスに解決するAmazon Route 53 Resolverサーバが機能しない。
  * この属性がtrueの場合、Amazonが提供するDNSサーバ(IPアドレス 169.254.169.253)へのクエリ、またはリザーブドIPアドレス(VPC IPv4ネットワークの範囲に2をプラスしたアドレス)へのクエリは成功する。

【用語解説】  
DNS名前解決：IPアドレスとURLなどを紐づけしてIPアドレスの行き先を探し出す事。

**VPCエンドポイント**  
VPCエンドポイントはインターネットを介さずにVPC内からVPC外のリソースに対してアクセスするための機能

ゲートウェイ型はS3とDynamoDBのみに適用される。他の多くのAWSサービスはプライベートリンク型(インターフェース)を利用する。

* ゲートウェイ型エンドポイント
  * サポートされたAWSサービスに対するトラフィックの宛先として指定できるゲートウェイ
  * ルートテーブルにトラフィック処理を設定して通信する。
  * DynamoDBとAmazon S3のみに適用可能

* プライベートリンク型エンドポイント(インターフェース型)
  * サポートされたAWSサービスに対するトラフィックのエントリポイントとして機能するプライベートIPアドレスを持つElastic Network Interface
  * プライベートIPアドレスを使用して外部サービスに対してプライベートにアクセスする。
  * AWS PrivateLinkは、VPCとサービス間のすべてのネットワークトラフィックをAmazonネットワークに制限
  * RDS、EC2などの多くのAWSサービスに適用可能
  * 2022年よりAmazon S2に対応、DynamoDBは未対応

**AWS PrivateLink**  
インターフェースエンドポイントを利用したプライベート接続を実施するサービス

* インターネットを経由せずVPCとAWSサービス、またはオンプレミス間にプライベート接続を確立する接続ポイント機能。(そのため、インターフェースエンドポイントはプライベートリンク型とも呼ばれる。)
* VPCの外部にあるサービス用に、インタフェースVPCエンドポイントを作成する。
* 他のAWSユーザからのアカウント内のAWSサービスへのアクセスを可能にする。
* AWS Direct Connectを使用したプライベート接続にも対応して、オンプレミスのアプリケーションからAWSリソースにプライベートネットワークを経由して接続できる。

**VPC Peering**  
VPC Peeringにより2つのVPCを接続して、トラフィックルーティングが可能となる。

* 異なるAWSアカウント間のVPC間をピア接続可能
* 一部のリージョン間の異なるVPC間をピア接続可能
* 単一障害点や帯域幅のボトルネックは存在しない

**トランジットゲートウェイ**  
トランジットゲートウェイを軸にハブ型の接続が可能となる。

**VPCとのオンプレミス接続**  
* AWS Direct Conect
  * オンプレミス環境からAWSプライベートネットワークへの専用線接続を作成する。
  * 専用線接続には外部ネットワークプロバイダーを利用して、Direct Connectロケーションでの物理接続が必要となる。

* AWS VPN
  * AWSサイト間VPN
    * オンプレミス環境からAWSプライベートネットワークへのVPN接続を作成する。

  * AWS Client VPN
    * クライアントからのVPN接続を実施するリモート接続用のサービス
    * オンプレミスとAWS両方のアプリケーションへの安全なアクセスを提供

**VPNとのDirect Connect**  
VPNの方が安く素早く利用できるが、信頼性や品質は専用線が勝る

* サイト間VPN
  * コスト：安価なベストエフォート回線が利用可能
  * リードタイム：クラウド上での接続設定で可能なため即時
  * 帯域幅：暗号化のオーバーヘッドにより制限がある
  * 品質セキュリティ
    * インターネット経由のためネットワーク状態の影響を受ける
    * ipsecによる通信暗号化
  * 障害切り分け：インターネットベースのため自社で保持している範囲以外の確認は難しい

* Direct Connect
  * コスト：キャリアの専用線サービス契約が必要となりVPNより割高
  * リードタイム：物理対応が必要ななため一カ月ほどの準備時間が必要
  * 帯域幅：ポートあたり1Gbps、10Gbpxまたは100Gbpまでの広帯域を実現
  * 品質セキュリティ
    * キャリアにより高い品質
    * 専用線によるセキュリティが高く、+VPNにより通信を暗号化可能
  * 障害切り分け：物理的に経路が確保されているため比較的容易

<a id="contents12"></a>

## 通信プロトコルとOSIモデル
**通信のルール**  
IPアドレスによって送付先の住所が分かっても、その中の誰に送信するのかも分からないといけないよね？

**通信プロトコル**  
HTTP(Hyper Text Transfer Ptorotocol)はHTML(Hyper Text Markup Language)で書かれた文章などの情報をやりとりする時に使われるプロトコル

**OSI参照モデル**  
この通信プロトコルを性質や送信対象に応じて、7つの層に分けているのがOSI参照モデルと呼ばれる規約

* アプリケーション層
  * WEBアプリケーションの通信サービスが実現できるよう固有の規定を定義
  * この中でアプリケーションごとにプロトコルが細分化されている
    * メールソフトウェア用プロトコル  
    ⇒ POP/SMTP
    * WEBブラウザ用プロトコル  
    ⇒ HTTP/HTTPS

* プレゼンテーション層
  * 文字の送り方を決めている所  
  文字コード・圧縮・データ暗号/復号など
  * 送信側と受信側のコンピュータで使用している氷原形式が異なっても、世界中でWEBサイトが表示されるのはこのため。

* セッション層
  * アプリケーション間でのセッションの確率、維持、終了するまでの手順を規定
  * セッションとはアプリケーションと通信した際の一連の継続的な処理やつながりの事。

* トランスポート層
  * ノード間のデータ伝送におけるコネクションを確立して、アプリケーション間でセッションを開始するためのポート番号の割り当てを規定
  * TCPを利用して、到着順序や到着確認を実施
    * コネクション：セッションでデータ転送を行うための論理的な回線の事
    * セッション：通信の開始から終了までを管理する1つの単位の事

* ネットワーク層
  * ノード間の起点から終点までの通信を規定
  * IPアドレスを利用した割り当てや、ルータによる宛先のコンピュータまでの最適なパスを選択してデータを送信などを実施

* データリンク層
  * 1つのネットワーク回線上で直接接続されたノード同士の通信について規定
  * LANではイーサネットにより同じネットワークセグメント内におけるノード間の通信をMACアドレスを利用して実施

* 物理層
  * ネットワークの物理的な接続や伝送方式を規定プロトコル
  * 0と1のビット列を電気信号に変換しネットワークへ伝送する方法など

**TCP/IPモデル**  
TCP/IPモデルはさらに実務的な処理にまとめたプロトコル群のこと。  
これを利用してプロトコル通信が設定されることが多い。

**ポート番号**  
通信する出入口となるのがポート番号で、メールボックスのような役割を担っている。

* 21：FTP  
ファイル転送用のプロトコル通信を実施

* 22：SSH  
Linuxマシンに接続する際のセキュアな接続を実施

* 80：HTTP  
非暗号化されたWEBサイトへの通信

* 443：HTTPS  
暗号化されたWEBサイトへの通信

* 3389：RDP  
Windowsサーバへのセキュアな接続を実施  
リモートデスクトップによる接続方式

* 3306：RDS  
Amazon RDSのDBインスタンスへのセキュアな接続を実施

<a id="contents13"></a>

## ネットワークACLとセキュリティグループ
**セキュリティグループ**  
インスタンスへのトラフィックのアクセス可否を設定するファイアーウォール機能を提供

**ネットワークACL**  
VPCとサブネットへのトラフィックのアクセス可否を設定するファイアーウォール機能を提供

VPC内のリソースにアクセスする際はセキュリティグループとNACLの両方の許可設定が必要

**NACLとSGの比較**  
セキュリティグループはネットワークACLは似たような機能だが、性質が異なる。

* セキュリティグループ設定
  * インスタンス単位で適用
  * 特定のVPCに紐づいて作成
  * ステートフル：インバウンドのみ設定すればアウトバウンドも許可される。(状態を維持)
  * 許可のみをIn/outで指定
  * デフォルトは全インバウンドが設定なし(暗黙の拒否設定)、アウトバウンドが許可される。
  * 全てのルールを適用

* ネットワークACLs設定
  * VPC/サブネット単位で適用
  * ステートフル：インバウンド設定だけではアウトバウンドは許可されない。
  * 許可と拒否をIn/outで指定
  * デフォルトでは全ての通信を許可する設定
  * 番号の順序通りに適用するため、重複したプロトコルに設定されている場合は小さな番号が優先される。

**ネットワークACL**  
デフォルトNACL(VPC作成時に自動的に作成されるACL)とカスタム(ユーザが作る)ACLのデフォルト初期設定では異なる設定がされている。

* VPC最初に設定されるデフォルトNACL
  * 全てのインバウンドトラフィックを許可する設定がされている。
  * 全てのアウトバウンドトラフィックを許可する設定がされている。

* カスタムで作成するNACLのデフォルト設定
  * 全てのインバウンドトラフィックを拒否する設定がされている。
  * 全てのアウトバウンドトラフィックを拒否する設定がされている。

**エフェメラルポートの利用**  
NACLを利用してサブネット内のリソースと通信をする際は特定ポート番号に加えエフェメラルポートの設定が必要

<a id="contents14"></a>

## Route53
**Route53とは何か？**  
IPアドレスを人が読みやすいURLに変換して、住所として利用できるようにしてくれるDNSサーバの役割を提供  

Route53はAWSが提供する権威DNSサーバで、ポート53で動作することからRoute53と呼ばれる。

DNSレコードというIPアドレスとURLを紐づけた表を確認してルーティングする。

**Route53の特徴**  
* 主要機能はドメイン登録/DNSルーティング/ヘルスチェックの3つ
* ポリシーによるルーティング設定  
トラフィックルーティング/フェイルオーバー/トラフィックフローに基づく様々な条件のルーティング設定が可能
* AWS側で100%可用性をを保証するSLA
* マネージドサービスとして提供しており、ユーザ側で冗長性などを考慮する必要がない
* ドメインを購入・登録・管理するレジストラーとしても機能する。
* 他のレジストラーで購入したドメインを移管する事も可能

**Route53の利用方法**  
Route53の利用を開始してドメインを登録すると自動でホストゾーンを自動生成し、そこにルーティングを設定する。

**ホストゾーン**  
ホストゾーンとはドメイン(example.com)とそのサブドメイン(sub.example.com)のトラフィックをルーティングするための情報を保持するコンテナの事

* パブリックホストゾーン
  * インターネット上に公開されたDNSドメインのレコードを管理するコンテナ
  * インターネットのDNSドメインに対するトラフィックのルーティング方法を定義

* プライベートホストゾーン
  * VPCに閉じたプライベートネットワーク内のDNSドメインのレコードを管理するコンテナ
  * VPC内のDNSドメインに対して、どのようにトラフィックをルーティングするかを定義
  * 1つのプライベートホストゾーンで複数VPCに対応
  * VPCが相互アクセス可能であれば複数リージョンのVPCでも、同じホストゾーンを利用可能

**レコードタイプ**  
ルーティング方法を設定するためにDNSレコードを作成し、各種レコードを設定する

* SOA
  * ドメインのDNSサーバ/ドメイン管理者のメール・アドレス/シリアル番号などを保持して、ゾーン転送時に情報が更新されているかの判断に利用する

* A
  * ホスト名とIPv4アドレスの関連付けを定義するレコード

* MX
  * メール配送先(メールサーバ)のホスト名を定義するレコード

* CNAME
  * 正規ホスト名に対して別名を定義するレコード。  
  特定のホスト名を別のドメイン名に転送する時などに利用する

【用語解説】  
DNSレコード：権威DNSサーバ内に存在し、ドメイン名に関連付けられたIPアドレスや、ドメインに対するリクエストを処理する方法などを設定する機能。

**エイリアスレコード**  
CloudFrontやELBなどのAWSリソースをドメインと関連付ける際にはAWS専用のエイリアスレコードを利用する。

* エイリアスレコードはDNSクエリにAWSサービスのエンドポイントのIPアドレスを返答することで、AWSリソースにドメイン名を設定する事が出来る。

* 以下のサービスに利用
  * 静的ウェブサイトとして設定されたS3バケット
  * CloudFront
  * ELB
  * AWS Elastic Beanstalk環境

* IPアドレスバージョンに応じたタイプ
  * エイリアスターゲットのIPアドレスを伴うAレコード(IPv4アドレス)
  * エイリアスターゲットのIPアドレスを伴うAAAAレコード(IPv6アドレス)

【用語解説】  
DNSクエリ：DNSクライアントがDNSサーバに送る要求メッセージの事。  
これを利用して特定のIPアドレス先を探索する際の要求を送信する。

**ルーティングポリシーの選択**  
様々なルーティング方式を選択して設定する事が可能

* シンプルルーティング
  * レコードセットにおいて事前に設定された値のみに基づいてDNSクエリに応答するルーティング方式
  * 静的マッピングによりルーティングを決定する。

* 加重ルーティング
  * 複数エンドポイントに重みを設定して、重みに応じてDNSクエリに応答するルーティング方式
  * 重みづけの高いエンドポイントに多くルーティングする。

* フェイルオーバールーティング
  * ヘルスチェックに基づいて、利用可能なリソースにDNSクエリを応答するルーティング方式
  * 利用可能なリソースにルーティングされる。

* 複数値回答ルーティング
  * 複数のリソースにトラフィックをルーティングさせる方式。
  * ランダムに選ばれた最大8つの別々のレコードにIPアドレスを設定して、複数の値を返答するルーティングさせる。
  * IPアドレス単位でヘルスチェックを実施してルーティングすることで、正常なリソースの値を返す。  
  ロードバランサー(ELB)に代わるものではないが、正常を確認して複数のIPアドレスを返す機能により、DNSを使用してアライビリティとロードバランシングを向上されることが出来る。

* レイテンシールーティング
  * リージョンのレイテンシーに応じて、DNSクエリに応答するルーティング方式。  
  ユーザの最寄りのリージョンになる事が多い。
  * リージョン間のレイテンシーが低い方にルーティングされる。

* 位置情報ルーティング
  * ユーザのIPアドレスにより位置情報を特定して、地域ごとに異なるレコードを返すルーティング方式
  * ネットワーク構成に依拠しない精度の高いレコード返答の区分けが可能となる。

* 地理的近接性ルーティング
  * ユーザとリソースの場所に基づいて地理的近接性ルールを作成して、トラフィックをルーティングする方式  
    * AWSリソースを使用している場合は、リソースを作成したAWSリージョンを場所とする。
    * AWS以外のリソースを使用している場合は、リソースの制度と経度で位置を場所とする。
  * 必要に応じてバイアスを設定し、地理的なリソースの配信範囲を調整することができる。
  * トラフィックフローを利用して設定する必要がある。

* IPベースのルーティングポリシー
  * トラフィックの送信元のIPアドレスが分かっている場合に、IPアドレスによるユーザの位置に基づいてトラフィックをルーティングする。
  * ユーザのIPアドレスからエンドポイントにマッピングすることで、きめ細かなルーティング制御が出来る。
  * 顧客ごとに特有な情報に基づいてルーティングを最適化する。
  * ユースケース
    * 特定のISPから特定のエンドポイントにエンドユーザをルーティングしたい場合
    * 位置情報ルーティングなど、既存のRoute53ルーティングタイプにオーバーライドを追加

**フェイルオーバー構成**  
フェイルオーバー構成はRoute53のヘルスチェック機能を利用したプライマリーとセカンダリーの冗長構成の事。

【用語解説】  
フェイルオーバー：システムに障害が発生した場合に、代替システムがその機能を自動的に引継ぎ、処理を続行する仕組みの事。

* フェイルオーバー(アクティブ/パッシブ)
  * Route53はプライマリリソースをアクティブなリソースとしてルーティングする。  
  障害が発生した場合、Route53はセカンダリーのリソースをルーティングする。
  * フェールオーバールーティングポリシーを使用して設定する。

* フェイルオーバー(アクティブ/アクティブ)
  * Route53は複数のリソースをアクティブとしてルーティングする。  
  障害が発生した場合、Route53は正常なリソースにフェイルバックする。
  * フェールオーバールーティングポリシー以外のルーティングポリシーを使用して設定する。

**Route53による地域制限**  
位置情報ルーティングを利用して、コンテンツの配布を配信権限がある位置だけにルーティングを制限することが出来る。

* 地域を指定して配信先としての制限設定し、受信許可がある場所のみに制限することができる。
* 地域に応じてルーティングさせるコンテンツを変更するなど、コンテンツ配布のローカライズを実施することが可能となる。
* 特定の地域からのエンドポイントを利用してローカルでのパフォーマンスを向上させる。

**トラフィックフロー**  
従来はALIASレコードを駆使して、複雑なルーティングポリシーを作成していたが、トラフィックフローによる視覚的なフローでの複雑なポリシー設定が可能となった

<a id="contents15"></a>

### DNSの名前解決
**DNSの役割**  
DNSはドメイン名をIPアドレスに変換する役割を担っており、ネームサーバーとリゾルバによって構成される。

* ネームサーバー
  * インターネット上でドメインとWebサーバやメールサーバを結びつけるための名前解決をするサーバです。

* リゾルバ
  * ドメイン名に対応づけられたIPアドレスを問われた際に、ドメイン名に関連付けられたネームサーバを指定して、名前解決を行ったくれるサーバ

<a id="contents16"></a>

## AWSアーキテクチャの設計原則
### AZの選択
1つのリージョンにつき2つのAZを利用してアーキテクチャーを設計することが基本(3つ以上はコスト効率が低下する)

マルチAZにサーバやDBの冗長構成を確立させることで高い可用性を実現する。

### VPC
1つのVPCでアーキテクチャを設計するのが基本となる。

* 1つのVPCを利用する。
  * 基本的には1つのVPCに1つのシステムやアプリケーションを配置するのが基本となる。
  * 1人で小規模に利用する場合は2つ以上のVPCを利用する方が面倒な場合は、1つのVPC内に複数のシステムを配置するケースがある。

* 2つ以上のVPC
  * システムを複数に分けることが必要な場合に利用する。  
  例えば、テスト用や本番用などに分ける場合にVPCを分割して利用する。
  * 2つ以上のVPCにより、ネットワークを分割したい場合に利用する。

2つにシステムを分けた方が良いケースでは、2つ以上のVPCに分けてアーキテクチャを配置する事で利用範囲を分割する

ネットワークの分割方法はマルチVPC方式とマルチアカウント方式を選択する。

### サブネットの分割
* サブネットはCIDR範囲で分割したネットワークセグメント  
* サブネットはインターネットアクセス範囲を定義するために利用する  
* WEBアクセスが必要か否かに応じて、パブリックサブネットとプライベートサブネットにVPCを分割する。
* サブネットのサイズは「/24～」以上(数値的に)のサブネットマスクによるIPアドレス範囲が推奨されている。
* 1つのAZに対して1つのパブリックサブネットと1つのプライベートサブネットが基本
* プライベートサブネットに多くのIPアドレスを割り当てる。

### マルチリージョンの活用
別リージョンにデータベースのレプリカを配置するなどして、データアクセスを分散する。

### Well-Architected Framework
Well-Architexted Frameworkでは6つの設計原則の柱が提示されている。

1. Reliability：信頼性  
障害による中断・停止と障害復旧による影響を軽減するインフラストラクチャーを構成する事。
    * 設計事項
      * インフラストラクチャサービスの障害復旧の自動化による影響を軽減する設計を行う。
      * 復旧手順をテストして事前に検証しておく。
      * 需要変化に応じた水平方向へのスケーラビリティによる高可用性を確保する。
      * キャパシティの推測をやめる。
      * モニタリングと自動化を進める。

信頼性の基本対応領域は基盤、変更管理、障害管理の3つ
* 信頼性の主要サービス
  * 基盤
    * IAM
    * VPC
    * Auto Scaling
    * ELB
    * Cloud Formation
  * 変更管理
    * Cloud Trail
    * AWS Config
  * 障害管理
    * Cloud Watch

2. Preformance Efficiency：パフォーマンス効率  
システム要件のリソース最適化により、AWSサービスの利用状況を効率化すること
    * 設計事項
      * システム要件を満たすためのコンピューティングリソースを効率化する。
      * システム要件やAWSサービスの変化に応じてAWSインフラの効率化を推進する。
        * 先端技術の一般化
        * グローバル化を即座に達成
        * サーバレスアーキテクチャの利用
        * より頻繁な実験

* パフォーマンス効率の主要サービス
  * コンピューティング
    * Auto Scaling
    * Lambda
  * ストレージ
    * EBS
    * S3
    * Glacler
    * EFS
  * データベース
    * RDS
    * DynamoDB
    * Elastic Search
    * Aurora
    * Redshift
  * 容量と時間のトレードオフ
    * Cloud Front
    * Elasti Cache

3. Security：安全性  
AWS内のデータ/システム/アセットの保護とモニタリングにより、セキュリティを高めること。

    * 設計事項
      * 全てのレイヤーにおいてセキュリティを適用する。
      * アクセス追跡・モニタリングを実施する。
      * 条件ドリブンのアラートをトリガーとしてセキュリティイベントへの応答を自動化する。
      * AWS責任共有モデルに基づく対象範囲の保護に集中する。
      * セキュリティのベストプラクティスの自動化
        * ソフトウェアベースのセキュリティ設定を使用し、迅速でコスト効率の良いスケーリングを安全に実行する。
        * 仮想サーバのカスタムベースラインイメージによる新サーバへの適用自動化
        * インフラストラクチャ全体のテンプレ化による管理

セキュリティの基本対応領域は、データ保護、権限管理、インフラ保護、検出制御の4つ

* セキュリティの主要サービス
  * データ保護
    * ELB
    * EBS
    * S3
    * RDS
    * KMS
  * 権限管理
    * IAM
    * MFA
  * インフラ保護
    * VPC
  * 検出制御
    * Cloud Trail
    * Cloud Watch
    * AWS GuardDuty
    * Amazon Inspector

4. Cost Optimization：コスト最適化  
不要なリソースの削減や最適な料金選択によりコストを削減すること

    * 設計事項
      * 不必要なリソースを削減する。
      * コストを計測して透明性のある費用付加を実現する。
      * マネージド型サービスを利用して運用コストを削減する。
      * 固定の償却コストを変動コストへと転換する。
      * スケールによるコストメリットを享受する。
      * データセンターへの投資を不要にする。

コスト最適化の基本対応領域は需要と供給の一致、コスト効率の高いリソース、支出の認識、継続した最適化の4つ

* コスト最適化の主要サービス
  * 需要と供給の一致
    * Auto Scaling
  * コスト効率の高いリソース
    * EC2購入方式
    * Trusted Advisor
  * 支出の認識
    * Cloud Watch
    * 見積りツール
  * 継続した最適化
    * AWS最新情報
    * Trusted Advisor

5. Operational Excellence：運用上の優秀性  
計画変更が起こった場合や予期せぬイベントの発生時において、運用実務の多くを自動化する。  
また、運用手順を文書化して、それをテストして検証しておくこと。

    * 設計事項
      * コードに基づいて運用実施を自動化する。
      * ビジネス目的に沿った運用手順を整備する。
      * 定期的かつ小規模に運用手順を整備する。
      * 予期せぬイベント発生に備えて応答テストを実施しておく。
      * 運用イベントと障害から学習して、運用手順を更新する。
      * 常に運用手順を最新のものに保持する。

運用上の優秀性の基本領域は準備、運用、進化の3つ

* 運用上の優秀性の主要サービス
  * 準備
    * Cloud Formation
    * Cloudシリーズ
    * Runbook Playbook
  * 運用
    * System Manager
    * Service Catalog
    * CloudTrail
    * AWS Artifact
    * AWS GuardDuty
    * Cloud Watch
    * AWS Config
    * API Gateway
  * 進化
    * 継続的かつ段階的な改善のために時間とリソースを割り当て、運用の有効性と効率性を向上させる

6. Sustainability：持続可能性  
2021年12月に初の変更点として6つ目の柱であるサステイナビリティが追加された。  

サステイナビリティの追求はAWS責任共有モデルにより、ユーザとAWS側の連携によっておし進められる。

**サステイナビリティの目標**  
AWSはクラウドのサステイナビリティの推進によって、インフラに関連するエネルギー使用率を80%削減する。

ユーザ側はクラウドを利用した効率的なアプリケーション設計やサービス選択を実施する。

**サステイナビリティの設計原則**  
ユーザは次の設計原則を意識してサステイナビリティを推進

* 影響を把握する
  * ビジネス上の成果と関連するサステイナビリティへの影響を測定し、パフォーマンス指標を確立し、改善を評価し、提案された変更が与える影響を推定する。

* サステイナビリティ目標の設定
  * ワークロードごとに長期的な目標を設定し、投資収益率(ROI)をモデル化し、サステイナビリティ目標に投資するりそーすを所有者に提供する。ユーザごと、オペレーションごとなど、作業当たりの影響を軽減するために、拡大を計画し、アーキテクチャを設計する。

* 使用率の最大化
  * 各ワークロードのサイズを適切に調整して、基盤となるハードウェアのエネルギー効率を最大化し、アイドル状態のリソースを最小限に抑える。

* より効率的な新しいハードウェアとソフトウェアの提供を予測して採用する
  * パートナーによるアップストリームの改善をサポートし、ハードウェアとソフトウェアの選択の効率性を継続的に評価し、新しいテクノロジーを長期にわたって採用できる柔軟性を考慮して設計する。

* マネージドサービスの使用
  * 共有サービスは、幅広いワークロードをサポートするために必要なインフラストラクチャの量を削減。マネージドサービスを活用してアクセス頻度の低いデータをコールドストレージに移動したり、性能を調整したりするなどして、影響を最小限に抑え、サステイナビリティのベストプラクティスを自動化する。

* クラウドワークロードのダウンストリームの影響を軽減
  * サービスの使用に必要なエネルギーやリソースの量を削減し、ユーザがデバイスをアップグレードする必要性を減らす。または、デバイスファームを使用したテストで影響を測定し、テストして、それらへの実際の影響を把握する。


Well-Architected Frameworkに準拠するためにガイドラインやツール、支援体制が提供されている。
1. Well-Architected Frameworkホワイトペーパー
1. AWSのSAまたは認定パートナーによる支援制度
1. セルフチェック向けのWell-Architected Tool

AWSのベストプラティスを利用することで最適解や改善点を把握する。あくまで参考であり絶対というものではない。
* 要件定義
  * AWSを利用したシステム要件を検討する材料としてホワイトペーパーを確認して最適な要件検討に利用する
* 設計
  * 設計においてホワイトペーパーを確認しながら、適切な設計方式を検討する
* 構築
  * リリース前にAWSのインフラ構成にリスクや改善点がないかホワイトペーパーに基づいて確認する
* 運用
  * 運用中に定期的にホワイトペーパーに沿ったレビューを実施し、リスクや改善点がないか確認する。

**サステイナビリティのベストプラクティス**   
ユーザは次のベストプラクティスに従ってAWSを利用することでサステイナビリティを推進

* ユーザの所在地に合わせて、ワークロードの地理的配置を最適化する。
* ユーザのデバイスや機器への影響を最適化する。
* データ分類ポリシーを実装する。
* ライフサイクルポリシーを使用して不要なデータを削除する。
* ネットワーク間でのデータ移動を最小化する。
* GPUの使用を最適化する。
* 潜在的なサステイナビリティの改善を迅速に導入できる開発方法とテスト
* ビルド環境の使用率を向上させる。

**サステイナビリティツール**   
AWSではサステイナビリティを達成するためのツールや支援体制を提供している。

* Amazon Sustainability Data Initiative(ASDI)
  * サステイナビリティの研究とイノベーションを加速することを目的とするイニシアティブ。サステイナビリティを次のレベルに引き上げるために必要なデータ、ツール、および技術的な専門知識でイノベーターと研究者をサポートする。

* AWS Data Exchange
  * クラウド内のサードパーティーのサステイナビリティ関連データ(環境、社会、企業統治に関するデータ、公共、天気、大気質、衛星画像データなど)を簡単に検索、サブスクライブ、および利用できる。

* AWS Customer Carbon Footprint Tool
  * AWSの製品とサービスの利用に伴う炭素排出量の概要を提供するダッシュボード。温室効果ガス・プロトコルの基準に従って、AWSの使用による排出量を報告出来るようにデータをビジュアル化してくれる。

* AWS Gravitonインスタンス
  * Amazon EC2で消費電力の1ワットあたりのパフォーマンスが最も高く、幅広いワークロードで最高のコストパフォーマンスを実現できる。消費するエネルギーを最大で60%削減し、同時にコストパフォーマンスも最大40%向上する。

<a id="contents17"></a>

## ELB
**ELBとは何か？**  
ELBは複数のEC2インスタンスによるトラフィック処理を可能にするロードバランサー機能を提供するサービス

EC2インスタンスのヘルスチェックを行い、正常なインスタンスのみを利用するように処理してくれる。

**ELBの特徴**  
負荷分散によるスケーラビリティとヘルスチェックにより、EC2ベースのシステムの高可用性を実現する。

* スケーラビリティの確保
  * 複数のEC2インスタンス/ECSコンテナを負荷分散する。

* 高可用性
  * 複数のアベイラビリティゾーンにある複数のEC2インスタンスの中から正常なターゲットに振り分ける。

EC2インスタンスのトラフィック処理を分散する際に利用するマネージド型のロードバランシングサービス

* インスタンス間の負荷を分散するサービス。インスタンスに限らずIPアドレスをターゲットにした負荷分散も出来る。
* ヘルスチェックにより異常なインスタンスを認識してトラフィックを正常なインスタンスのみに分散させる。
* パブリックサブネット/プライベートサブネットのどちらでも使用可能
* 負荷に応じてELB自体のキャパシティを増減させるスケーリングを実施する。これはAWS側が自動で設定して管理している。
* 時間に応じたロードバランサーキャパシティーユニット(LCU)使用量に課金(CLBのみ転送データ単位)される。
* セキュリティグループで通信可能なプロトコルを制御する。
* ログを有効化することで、ログをS3バケットに保存する。

**ELBの構成**  
ELBを利用したマルチAZにインスタンスへのトラフィックを分散する構成が利用される。  
ELBはリージョンを跨げない。

プライベートサブネット空間にもELBを利用することが可能

プライベートサブネットに対してパブリックネットワークとつながったELBを構成してトラフィック分散させることもできる。

**ELBのタイプ**  
現在利用できるロードバランサーは3タイプで用途に応じて使い分ける

* Classic Load Balancer(CLB)
  * レイヤー4と7に対応しており、TCP,SSL,HTTP,HTTPSリスナーを利用  古いタイプなのでALB/NLBの利用を優先する。  
  データ転送(GB単位)に応じて課金される。  
  IPアドレスが可変であるため、指定時にDNSのみ利用可能

* Application Load Balancer(ALB)
  * レイヤー7に対応しHTTP/HTTPSリスナーに対応  
  パスルーティングが利用可能  
  時間に応じたロードバランサーキャパシティーユニット(LCU)の使用量で課金される。  
  IPアドレスが可変であるため、指定時にDNSのみ利用可能  
  デフォルトでクロスゾーン負荷分散が有効

* Network Load Balancer(NLB)
  * レイヤー4に対応し、NATロードバランサでTCPリスナーに田泓(戻りトラフィックがNLBを経由しない)  
  時間に応じたLCUの使用量で課金される。  
  NLBのサブネット拡張サポート(サブネットを追加できる)  
  固定IPのためDNSとIPのどちらも利用可能  
  ALBよりも高パフォーマンス処理が可能  
  デフォルトでクロスゾーン負荷分散が無効

**ELBの主要機能**  
* ヘルスチェック
  * EC2インスタンスの正常/以上を確認し、利用するEC2の振り分けを行う

* クロスゾーン負荷分散
  * 配下のEC2の負荷に応じて、複数のAZにまたがるEC2インスタンスに均等に負荷分散を行う

* リスナー設定
  * ELBはリスナー設定によって、通信するプロトコルタイプや通信ルールを設定することが出来る。

* 暗号化通信
  * SSL/TSL証明書をELBに設定することでHTTPSまたはTLS通信を実施することが出来る。

* スティッキーセッション
  * セッションを継続して、同じクライアント端末からのリクエストを継続して同じEC2インスタンスに送信する。

* Connection Draining
  * インスタンスに異常が発生した場合に、そのバックエンドインスタンスへの指定した秒数の間は通信が切れずに、処理中のリクエストが終わるまで一定期間待ってくれる

<a id="contents18"></a>

## Auto-Scaling
**Auto-Scalingとは何か？**  
インスタンスへのアクセスが高まった時に、新しいインスタンスを増設して、パフォーマンスを向上させる機能

**スケーリングのタイプ**  
スケーリングタイプは垂直スケーリングと水平スケーリングの2タイプ。Auto-Scalingは水平スケーリング

* 垂直スケーリング
  * 拡張方法
    * スケールアップ：メモリやCPUの追加・増強
  * 低減方法
    * スケールダウン：メモリやCPUの削減・低性能化

* 水兵スケーリング
  * 拡張方法
    * スケールアウト：処理する機器/サーバ台数を増加する
  * 低減方法
    * スケールイン：処理する機器/サーバ台数を低減する

**Auto-Scalingの設定プロセス**  
Auto-Scaling設定にはELBと起動テンプレートを事前に準備する事が必要

**ELBとの連携**  
Auto-Scalingで起動するインスタンスをELBのターゲットグループ内に配置することが可能

**Auto-Scalingの要素**  
起動テンプレートによりインスタンスの設定を準備した後、Auto-Scalingグループを設定する。

* 起動テンプレート
  * Auto-Scalingによって起動するインスタンスタイプなどの起動方法の詳細を設定する。
  * 起動テンプレートにスケーリングするインスタンスを設定する。
  * 起動テンプレートはインスタンス起動全般で利用可能であり、バージョニングなどの機能が充実している。

* Auto-Scalingグループ
  * Auto-Scalingのグループサイズ(起動するインスタンス数)を設定する。
  * 実行時のしきい値を設定する。
  * スケールリング方式を決定するスケーリングポリシーを設定して、スケールアウトとスケールインの方式を設定する。
  * スケーリングを終了させるためのターミネーション(終了)ポリシーを設定する。

**起動テンプレートの作成**  
起動テンプレートはEC2で説明した起動設定をテンプレート化して、自動で起動する際に利用する仕組み

**基本アーキテクチャー**  
ELB構成で冗長化したうえでAuto-Scalingを設定して自動拡張出来るようにする

**スケーリングポリシーの設定**  
スケーリングポリシーを設定して、スケーリングを実施する。

* 動的スケーリング
  * 簡易スケーリングポリシー
    * ターゲット追跡スケーリングポリシーの通常の設定
    * アラーム設定に基づいて1段階のスケーリングを実施
  * ステップスケーリングポリシー
    * アラーム超過のサイズに基づいてインスタンス数を動的にスケーリングする1つ以上のステップ調整値を指定して複数回の段階的なスケーリングを実施

* 手動スケーリング
  * 希望する容量を調整して、手動でスケーリングを実施する。

* スケジュールされたスケーリング
  * スケーリングを実施する日時を指定して、スケーリングを実行する。

<a id="contents19"></a>

## S3
**S3とは何か？**  
S3は耐久性と可用性が非常に高くデータの中長期保存に最適なストレージ

**S3のユースケース**  
コンテンツ配信用の画像データなどをS3に保存して、CloudFrontを利用して配信する。

**S3ストレージの特徴**  
AWSは3つの形式のストレージサービスを提供

* ブロックストレージ
  * EC2にアタッチして活用するディスクサービス
  * ブロック形式でデータ保存
  * 高速・広帯域幅
  * 例：EBS、インスタンスストア

* オブジェクトストレージ
  * 安価かつ高い耐久性を持つオンラインストレージ
  * オブジェクト形式でデータを保存
  * デフォルトで複数AZに冗長されている。
  * 例：S3、Glacier

* ファイルストレージ
  * 複数のEC2インスタンスから同時にアタッチ可能
  * ファイル形式でデータを保存
  * 例：EFS

S3はバケット単位で保存スペースを区分し、オブジェクトでデータを格納する

**バケット**  
ユーザが利用する1つのストレージ単位をバケットとして作成する。

* S3を利用する際に1つのバケットを作成して、そこにオブジェクト(ファイル)を格納する。
* バケットはリージョンに設定する。AZやVPCの範囲外。
* バケットにはグローバルに一意の名前を設定する事が必要。
* 命名規則を守る必要がある。

**S3の利用コスト**  
ストレージのコストを比較するとインスタンスストアを除けば、最も値段が安いのはGlacier deep archive

* S3のデータ容量に応じたコスト
  * 標準：1GBあたり0.025USD/月
  * S3 Intelligent Tiering：標準と標準IAの組み合わせ
  * 標準IA：1GBあたり0.019USD/月
  * One Zone IA：1GBあたり0.0152USD/月
  * Glacier：1GBあたり0.005USD/月
  * Glacier deep archive：1GBあたり0.002USD/月

* EBSの汎用ストレージのコスト
  * 汎用：1GBあたり0.12USD/月
  * コールドHDD：1GBあたり0.03USD/月

* EBSのストレージのコスト
  * 標準：1GBあたり0.36USD/月
  * 低頻度アクセス：0.0272USD/月

* インスタンスストア
  * EC2インスタンスに含まれる。

S3はデータ量とリクエストとデータ転送に対して料金が発生

* リージョン
  * リージョン：リージョン毎に価格が異なる。

* データ容量
  * データ容量：データ量と保存期間に応じて料金がかかる。(GB当たり)
  * S3 Intelligent Tiering、IAストレージには、最低30日間の料金

* リクエストとデータ取得
  * データに対するリクエストに応じて料金がかかる。(1000リクエストあたり)
  * データを取得した量に応じて料金がかかる(GBあたり)

* データ転送
  * データ転送イン：無料
  * インターネットへのデータ転送アウト(GBあたり)
  * S3からAWS内でのデータ転送アウト(GBあたり)

S3はボリュームディスカウントの価格帯が設定されている。

**リクエスタ支払い**  
S3バケットはデータ取得の際にも料金が発生する場合があるため、リクエスタ支払いはデータ取得したアカウントに課金する。

* データ保存コスト
  * リクエスタ支払い無効
    * バケットの所有者がデータの保存コストを支払う
  * リクエスタ支払い有効
    * バケットの所有者がデータの保存コストを支払う

* データ通信コスト
  * リクエスタ支払い無効
    * バケットの所有者がデータのダウンロードコスト(通信料)を支払う
  * リクエスタ支払い有効
    * データダウンロードをリクエストしたアカウントがデータのダウンロードコスト(通信料)を支払う

**ストレージクラスの選択**  
S3の用途に応じてストレージタイプを選択する

* STANDARD
  * 特徴
    * 複数個所にデータを複製するため耐久性が非常に高く、頻繁に利用するデータを大量に保存するのに向いている。
    * データは3AZ以上で分散保存される。
  * 性能
    * 耐久性：99.999999999%
    * 可用性：99.99%
  * 追加課金
    * 最低利用料金：なし
    * データ取得料：なし

* STANDARD-IA
  * 特徴
    * IAはIngrequency Accessの略であり、低頻度アクセスデータ用ストレージ。  
    One Zone-IAより重要なマスターデータ向け。データ取得は早い
    * Standardに比べて安価だが、One Zone-IAよりは高い。
  * 性能
    * 耐久性：99.999999999%
    * 可用性：99.99%
  * 追加課金
    * 最低利用料金：30日
    * データ取得料：GB当たり取得料

* One Zone-IA
  * 特徴
    * 低頻度アクセス用のストレージだが、マルチAZ分散されていないため可用性が低く、重要ではないデータ向け。その分STANDARD-IAよりも値段が安い
  * 性能
    * 耐久性：99.999999999%
    * 可用性：99.5% = 1AZ
  * 追加課金
    * 最低利用料金：30日
    * データ取得料：GB当たり取得料

* S3 Intelligent Tiering
  * 特徴
    * 高頻度と低頻度という2つのアクセス階層を利用し、アクセスがあるファイルは高頻度(標準クラス)に維持しつつ、アクセスがないファイルは低頻度(標準IAクラス)に自動で移動する。
    * アクセスパターンが分からない場合に利用
  * 性能
    * 耐久性：99.999999999%
    * 可用性：99.9%
  * 追加課金
    * 最低利用料金：30日
    * データ取得料：なし

**バージョン管理**  
ユーザによる誤操作でデータ削除などが発生してもバージョンから復元できる

* バージョニングの基本
  * バケット単位でオブジェクトのバージョンを管理する
  * バージョン毎にオブジェクトが保管される
  * ライフサイクルルールによってバージョンが保存される期間を設定できる
  * バージョニングが有効になる前のバージョンはnullとなる。

**S3 MFA Delete**  
バージョン機能のオプション。バージョンIDを指定する削除操作のみ、MFSデバイスによる認証を必須とする。

**S3イベント**  
S3オブジェクト操作と連動したシステム連携処理を実現

* S3のイベント通知
  * バケット内イベントの発生をトリガーにして、SNS/SQS/Lambda/Amazon EventBridgeに通知設定が可能
  * S3オブジェクト操作と連動したシームレスなシステム連携処理を実現
    * S3へのデータアップロードをSNSでメッセージ通知
    * S3オブジェクトのアップロードをトリガーにLambda関数を実行

**マルチパートアップロード**  
大容量オブジェクトをいくつかに分けてアップロードする機能

**S3 Transger Acceleration**  
データ転送元から地理的に一番近いエッジロケーションを利用して高速にデータアップロードを実施する。

**静的WEBホスティング**  
S3を利用して簡易な静的WEBサイトを作ることが出来る機能

**ライフサイクル管理**  
時間に応じてオブジェクトのストレージクラスの変更や削除を自動的に行うルールを設定できる。

* 設定方法
  * バケット全体やプレフィックスに設定
  * オブジェクト更新日を基準にして日単位で指定し、毎日0:00UTCにキューを実行
  * 最大1000までのライフサイクルルールを利用可能
  * IAに移動できるのは128KB以上のオブジェクト
  * MFA Deleteが有効だと設定負荷

**S3のアクセス管理**  
S3のアクセス管理にはユーザベースのIAMとリソースベースのバケットポリシーとACLを主に利用する。

* 管理方式
  * IAMユーザポリシー
    * 特徴
      * IAMユーザに対してAWSリソースとしてのS3へのアクセス権限を設定
      * 内部のIAMユーザやAWSリソースへの権限管理
  * バケットポリシー
    * 特徴
      * バケットのアクセス権をJSONで設定する。  
      1つのバケットに対して1つだけ設定可能。
      * 外部ユーザやアプリケーションなども管理可能
  * ACL
    * 特徴
      * バケット/オブジェクト単位でのアクセス権限をXMLで設定することができる
      * オブジェクトに個別に設定可能
  * アクセスポイント
    * 特徴
      * S3バケットにアクセスポリシーを設定する。
      * バケットのアクセス権をJSONで設定する。  
      1つのバケットに対して複数設定可能
      * 外部ユーザやアプリケーションなども管理可能

**S3の保管データの暗号化**  
S3へのデータ保管時に暗号化形式として以下の4つの形式から選択する。

* 暗号化方式
  * SSE-S3
    * 特徴
      * S3の標準暗号化方式で簡易に利用可能
      * 暗号化用のマネージドキーの作成・管理をS3側で自動で実施
      * ブロック暗号の1つである256ビットのAdvanced Encryption Standard(AES-256)を使用してデータを暗号化
  * SSE-KMS
    * 特徴
      * AWS KMSに設定したキーを利用した暗号化を実施
      * ユーザ側でAWS KMSを利用して暗号化用のマネージドキーを作成・管理することが可能
      * AES-256を利用
  * SSE-C
    * 特徴
      * ユーザが指定した暗号化用のマネージドキーをデータと共に送付して、サーバ暗号化(SSE-C)を実施する
      * 利用設定や管理が煩雑になるのがデメリット
  * クライアントサイド暗号化(CSE)
    * 特徴
      * クライアント側の暗号化では、Amazon S3に送信する前にデータを暗号化する方式
      * アプリケーションに保存したマスターキーを使用

**暗号化リクエスト**  
オブジェクトのアップロードリクエスト処理の際に暗号化用のヘッダーが付与されて暗号化が実施される。

<a id="contents20"></a>

## データベースの基礎
**データベース**  
データベースは関連したデータの形式を揃えて収集・整理して、検索などの操作やデータ管理を実行するシステム

基本的なデータベースはテーブルという形式でデータを格納している。

データベースは追加・更新・削除などのデータ操作を容易に実行するソフトウェアやデータモデルと一体

* 追加：データを整理して保存したい
* 参照：必要なデータを参照または抽出したい
* 更新：データの変化に応じて好きな時に更新したい。
* 削除：必要ないデータを削除したい。

**データベースとストレージ**  
ストレージはデータベースの記憶装置を構成する1つの要素

* ストレージ
  * コンピュータの主要な構成要素の一つで、データを永続的に記憶する装置

* データベース
  * データベース内のデータを保存する装置はストレージであるが、データベースそのものではない。
  * ストレージ+データを管理・操作するデータベースソフトウェア

**データベースの役割**  
データベースはデータ操作を異常なく実行でき、データを安全に保護しつつ、保存・操作ができる仕組みを提供している。

【データ操作にかかる様々な問題】
* システムがクラッシュした時にデータが消えないか？
* データを誤って削除してしまった場合に対処できないか？
* データ抽出に誤りが発生しないか？
* 2人が同時に同じデータにアクセスした際にどうするか？
* 大量のデータを上手く検索できないか？

***

**トランザクション**  
データベースをある一貫した状態から別の一貫した状態へ変更する1つの処理の束の事
  * 同時アクセスした場合に上手く処理する。
  * データ処理に失敗したら、元に戻してくれる。
  * システムがクラッシュしてもデータを保護する。

**トランザクション：ACID**  
ACIDは信頼性のあるトランザクションシステムの持つべき性質のこと

* Atomicity(原子性)  
トランザクションが「全て実行される」か「1つも実行されない」のどちらかの状態になるという性質

* Consistency(整合性)  
トランザクションの前後でデータの整合性が保たれ、矛盾の無い状態が継続される性質

* Isolation(独立性)  
トランザクション実行中の処理過程が外部から隠蔽され、他の処理などに影響を与えない性質

* Durability(耐久性)  
トランザクションが完了したら、その結果は記録され、クラッシュしても失われる事がないという性質

**トランザクション：耐久性**  
データを更新する際にCOMMITとする更新が反映されるが、COMMITされないとデータがロールバックして保護する。

**トランザクション：整合性**  
同時に複数人がアクセスした場合などにデータ整合性を維持する必要がある。

**整合性モデル**  
同時に複数人がアクセスした場合などの、データのデータ整合性を維持するための方式(結果整合性や強い整合性など)

**データモデル**  
実世界におけるデータの集合を、DBMS上で利用可能な形に落とし込むためのモデル

データモデルはデータベースのデータの持ち方などの構造や処理を定めるデータの論理的な表現方法

データベースには様々データモデルが存在し、利用目的に応じて使い分ける

* リレーショナルモデル
* グラフモデル
* キーバリューストア
* オブジェクト
* ドキュメント
* ワイドカラム
* 階層型

<a id="contents21"></a>

## RDB
**RDBとは何か？**  
RDBはリレーショナルデータベースをクラウド上で即時に起動して、利用することが出来るサービス

**リレーショナルモデル**  
データベースはリレーショナルモデルが基本的なデータモデルとなっている。

**RDBの特徴**  
RDSは様々なデータベースソフトウェアに対応したフルマネージドなリレーショナルデータベース

以下のような標準ソフトウェアを利用したデータベースを構築できる

* MySQL
* ORACLE
* Microsoft SQL Server
* PostgreSQL
* MariaDB
* Amazon Aurora
* DB2(新規に追加されたIBMのDBエンジン)

**RDBのベストプラクティス**  
RDBは主だったベストプラクティスとして以下のような内容が推奨されている。

* データをメモリ内に保持出来るように十分なRAM(メモリ)を割り当てる。
* 拡張モニタリングを使用したオペレーティングシステムの問題を特定する。
* 特定のメトリクスしきい値に対してAmazon Cloud Watchアラームを設定する。
* MySQLのストレージエンジンにはInnoDBを利用する。
* 大きなテーブルのパーティションは16TBを超えないようにする。

**マネージド型DBの特徴**  
RDSはマネージド型であるため、クラウド型が多くの管理タスクを実施している。

**RDSの制約事項**  
RDSはマネージド型であり管理が楽な反面、AWSから提供される機能範囲内での制限を受ける。

* RDSの主な制約事項
  * バージョンが限定される
  * キャパシティに上限がある
  * OSへのログインができない
  * ファイルシステムへのアクセスができない
  * 一部の機能が使えない
  * 個別パッチは適用できない

**ストレージタイプの選択**  
ストレージタイプは汎用とプロビジョンドIOPSタイプから選択する。  
マグネティックは古いタイプであり、あまり利用しない

* 汎用
  * SSDタイプ
  * GBあたりの容量課金を実施
  * 通常のパフォーマンスに加えてバーストを実施し、100~10,000IOPSを実現可能(サイズによって変わる)

* プロビジョンドIOPS
  * SSDタイプ
  * GBあたりの容量課金を実施+プロビジョンド済みIOPS単位の課金
  * 通常のパフォーマンスに加えてバーストを実施し、1,000~30,000IOPSを実現可能(サイズによって変わる)

* マグネティック
  * ハードディスクタイプ
  * GBあたりの容量課金を実施+IOリクエスト課金
  * 平均100~最大数百のIOPS

**パブリックアクセス構成**  
パブリックアクセスを有効化して、セキュリティグループでアクセスを許可する必要がある。

パブリックサブネットにRDSを設置し、直接SQLソフトウェアで接続して操作する。

**一般的な構成**  
RDSをプライベートサブネットに設置して、EC2インスタンスを踏み台にしてアクセスする。

この構成は1つのAZに依存しているため、AZ障害が発生するとダウンタイムが発生するリスクが高い。

**マルチAZ構成**  
マルチAZ構成にすることで、AZ障害が発生しても停止しない構成を取る必要がある。

**マルチAZ構成による効果**  
フェールオーバー設定を有効化するだけで、非常に簡単にフェールオーバーが利用可能となる。

* プライマリーデータベースとセカンダリーデータベースの2重構成となる。
* 2つのデータベースは動機レプリケーションを実施し、常に同じデータ内容を維持する。
* プライマリー側に障害が発生した場合、自動でフェールオーバーが実行されセカンダリーデータベースがプライマリーに昇格する。
* フェールオーバー時にCNAMEレコードがプライマリーからセカンダリーに移行する。
* スタンバイ状態のDBは利用できない。

**RDSの暗号化**  
RDSでは保存されるデータ・リソースの暗号化と接続の暗号化を実施可能

* 通信の暗号化
  * SSL/TLSを使用してDBインスタンスへの接続を暗号化する。
  * SSL/TLS証明書はデフォルトで自動で構成されて暗号化される。

* 保管データの暗号化
  * AWS KMSの暗号化キーを利用して、保管時のデータリソースを暗号化する。

保管時のデータ/DBインスタンスとスナップショットを暗号化

* 暗号化対象
  * DBインスタンス
  * 自動バックアップ
  * リードレプリカ
  * スナップショット

* 暗号化方式
  * AES-256暗号化
  * AWS KMSの暗号化キーを利用して暗号化される。
  * リードレプリカも同じ鍵を利用して暗号化される。
  * インスタンス作成時にのみ暗号化を実施する。途中で暗号化する事は出来ない。
  * スナップショットのコピーも暗号化する。
  * スナップショットからDBをリストアする際に暗号化キーの権限が必要となる。

**バックアップ**  
スナップショットを取得することでデータを保存し、耐障害性を確保することができる。

RDSのバックアップはスナップショットで取得され、2つの方法が提供されている。

* 自動バックアップ
  * 自動バックアップ有効化されていると、Amazon RDSは毎日、データのスナップショットを自動的に作成する。  
  ポイントタイムリカバリができる。

* スナップショットの取得
  * ユーザによって指定された頻度でスナップショットを取得することが出来る。

<a id="contents22"></a>

## AWSの責任共有モデル
セキュリティに対してAWSとユーザとで責任分界して対応する責任共有モデルとなっている。

**責任共有モデルの統制範囲**  
セキュリティに対してAWSとユーザとで責任分界して対応する責任共有モデルとなっている

* 継承される統制  
ユーザがAWSから完全に継承する統制  
物理統制と環境統制がある

* 共有統制
  * バッチ管理  
  AWSがインフラストラクチャの不具合に対するパッチ適用および修復に責任を負うが、ユーザはゲストOS及びアプリケーションのパッチ適用に責任を負う。
  * 構成管理  
  AWSガインフラストラクチャデバイスの構成を保守するが、ユーザは独自のゲストオペレーティングシステム、データベース、アプリケーションの構成に責任を負う
  * 意識とトレーニング  
  AWSがAWS従業員のトレーニングを実施するが、ユーザの従業員のトレーニングはユーザが実施する

* ユーザ固有の統制  
AWSサービスにデプロイするアプリケーションに基づいて、ユーザが全ての責任を負う統制。データをルーティングまたは区分する必要があるサービスおよびデータ通信の保護またはゾーンセキュリティなど

<a id="contents23"></a>

## IAMの概要
**IAMとは**  
AWS Identity and Access Management(IAM)は安全にAWS操作を実施するための認証・認可の仕組み

* AWSアカウント内のユーザを作成
* AWSリソースへのアクセス権限を管理
* リソース間のアクセス権限を管理
* 一時的なアクセスを許可

**主要トピック**  
IAMの主要要素はユーザ、グループ、ポリシー、ロール

* IAMポリシー
  * ユーザなどへのアクセス権限を付与するための設定ドキュメントのこと(JSON形式の文書)
  * IAMポリシーはJSON形式でAWSリソースへのアクセス権限を設定するドキュメント

* IAMユーザ
  * IAMポリシー内でAWSサービスを利用できるユーザ。基本操作はIAMユーザで実施することになる
  * AWS上の利用者はIAMユーザという権限を付与されたエンティティとして設定される。
    * ルートユーザ(IAMではない)
      * AWSアカウント作成時に作られるIDアカウント
      * 全てのAWSサービスとリソースを使用できる権限を有する
      * 日常的なタスクはルートユーザを使用しない事が強く推奨される
      * ルートユーザのみの実施権限
        * AWSルートアカウントのメールアドレスやパスワードを変更する。
        * IAMユーザによる課金情報へのアクセスを許可する。
        * 他のAWSアカウントに対してRoute53ドメイン登録を移行する。
        * AWSサービス(サポート等)をキャンセルする。
        * AWSアカウントを停止する。
        * コンソリデイテッドビリング(一括請求)を設定する。
        * 脆弱性診断を実施するための脆弱性診断フォームを提出する。
        * 逆引きDNS申請をする。

    * 管理者権限(IAMユーザ)
      * 管理者権限の許可が付与されたIAMユーザの事
      * IAMの操作権限まであり
      * ルートアカウントしか出来ない権限は付与されない。
    * パワーユーザ(IAMユーザ)
      * パワーユーザはIAM以外の全てのAWSサービスにフルアクセス権限を有するIAMユーザ
      * IAMの操作権限なし

* IAMユーザグループ
  * グループとしてまとめて権限を付与する仕組み
  * グループには複数のIAMユーザが設定される

* IAMロール
  * AWSリソースが別のリソースに対するアクセス権限を付与する仕組み
  * 別のAWSアカウントのIAMユーザにアクセス権限を委譲する際にも利用

**IAMで使われる用語**  
IAMで利用される専門用語が似通っているため、違いを抑えることが重要

* IAMリソース  
IAMで保存・管理されるユーザ、グループ、ロール、ポリシー、およびIDプロバイダー

* IAMアイデンティティ
  * ユーザ、グループおよびロール
  * AWSで認証されてグループ化に使用されるIAMリソースオブジェクトの事。

* IAMエンティティ
  * ユーザ及びロール
  * AWSに認証されるIAMリソースオブジェクト

* プリンシパル
  * ルートユーザ、IAMユーザ、またはIAMロールを使用する人又はアプリケーション
  * フェデレーティッドユーザと引き受けたロールも含まれる

**AWS Organizationとは何か？**  
複数のAWSアカウントを利用している場合に、統合管理を実施することが出来る。

AWS OrganizationはIAMのアクセス管理を大きな組織でも楽に実施出来るようにするマネージド型サービス

* 複数アカウントの一元管理  
AWSアカウントをグループ化してポリシーを適用して一元的に管理する。

* 新規アカウント作成管理  
AWSアカウントを新規に作成する際の作成  
内容をログ管理できる。

* 一括請求  
複数AWSアカウントの請求を一括化する。

<a id="contents24"></a>

## CloudTrailの概要
**CloudTrailの設定**  
CloudTrailによりユーザのアクセスログを取得・監視することができる。

**AWS CloudTrail**  
AWSユーザの操作(APIコールやユーザのサインインアクティビティ)をロギングするサービス

* ルートアカウント/IAMユーザのオペレーションとAPIコールをトラッキングしてログを取得するサービス
* CloudTrailログファイルは暗号化されてS3に保存
* KMSによる暗号化もサポート
* デフォルトでは90日間ログが保存される
* 無料

ユーザアクセスとAPIコールのログ情報をS3バケットに保存し、CloudWatch上で解析できる。

<a id="contents25"></a>

## CloudWatchの概要
AWSリソースとAWSで実行するアプリケーションのモニタリングサービスで、様々なログやメトリクスを監視できる

* モニタリング
* 監視の集約化
* トラブルシューティング
* ログ解析
* 自動アクション
* 運用状況の確認

**CloudWatchの機能**  
AWSリソースとAWSで実行するアプリケーションのモニタリングサービスで、様々なログやメトリクスを監視できる

* CloudWatchアラーム  
CloudWatchメトリクスに基づく数式の結果を監視するメトリクスアラームを作成する。また、他のアラームのアラーム状態を考慮したルール式が含める複合アラームが作成できる。

* CloudWatchメトリクス  
EC2などのAWSリソースの監視サービスであり、死活監視、性能監視、キャパシティ監視を実施する。  
有料枠では確認内容や設定の柔軟性が充実化する

* CloudWatch Logs  
CloudWatchと連動したログを収集・可視化する機能。  
EC2上のOS・アプリケーションのログやAWSマネージドサービスのログを取得する。

* CloudWatch Events ⇒ Amazon Event Bridgeに統合  
CloudWatchはAWSリソースに対するイベントをトリガーにアクションを実行する。  
オペレーションの変更に応答し、応答メッセージ送信、機能のアクティブなどを実施する。

<a id="contents26"></a>

## AWSコスト管理
**Cost Optimization：コスト最適化**  
不必要なリソースを削減し、最適な料金選択によりコストを最適化すること

* 【設計事項】
  * 不必要なリソース削減
  * 透明性のある費用賦課
  * マネージド型サービスの利用によるコスト削減
  * 固定の償却コストを変動コストへと転換
  * スケールによるコストメリット
  * データセンターへの投資不要化